// Build date: 2017-06-14T15:34:07

/*
* Author    Jonathan Lurie - http://me.jonathanlurie.fr
* License   MIT
* Link      https://github.com/jonathanlurie/canvasSpliner
* Lab       MCIN - http://mcin.ca/ - Montreal Neurological Institute
*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(h,q,g){if(g.get||g.set)throw new TypeError("ES3 does not support getters and setters.");h!=Array.prototype&&h!=Object.prototype&&(h[q]=g.value)};$jscomp.getGlobal=function(h){return"undefined"!=typeof window&&window===h?h:"undefined"!=typeof global&&null!=global?global:h};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(h,q,g,e){if(q){g=$jscomp.global;h=h.split(".");for(e=0;e<h.length-1;e++){var c=h[e];c in g||(g[c]={});g=g[c]}h=h[h.length-1];e=g[h];q=q(e);q!=e&&null!=q&&$jscomp.defineProperty(g,h,{configurable:!0,writable:!0,value:q})}};$jscomp.polyfill("Array.prototype.fill",function(h){return h?h:function(h,g,e){var c=this.length||0;0>g&&(g=Math.max(0,c+g));if(null==e||e>c)e=c;e=Number(e);0>e&&(e=Math.max(0,c+e));for(g=Number(g||0);g<e;g++)this[g]=h;return this}},"es6-impl","es3");
(function(h,q){"object"===typeof exports&&"undefined"!==typeof module?q(exports):"function"===typeof define&&define.amd?define(["exports"],q):q(h.CanvasSpliner=h.CanvasSpliner||{})})(this,function(h){var q;q=function(){function a(a,p){var b,c,r,m,d,e,h,f,n,k,g;h=a.length;r=[];e=[];b=[];c=[];m=[];f=[];d=0;for(n=h-1;0<=n?d<n:d>n;0<=n?d+=1:--d)r[d]=(p[d+1]-p[d])/(a[d+1]-a[d]),0<d&&(e[d]=(r[d-1]+r[d])/2);e[0]=r[0];e[h-1]=r[h-2];n=[];d=0;for(k=h-1;0<=k?d<k:d>k;0<=k?d+=1:--d)0===r[d]&&n.push(d);k=0;for(g=
n.length;k<g;k++)d=n[k],e[d]=e[d+1]=0;d=0;for(n=h-1;0<=n?d<n:d>n;0<=n?d+=1:--d)b[d]=e[d]/r[d],c[d]=e[d+1]/r[d],m[d]=Math.pow(b[d],2)+Math.pow(c[d],2),f[d]=3/Math.sqrt(m[d]);n=[];d=0;for(k=h-1;0<=k?d<k:d>k;0<=k?d+=1:--d)9<m[d]&&n.push(d);m=0;for(k=n.length;m<k;m++)d=n[m],e[d]=f[d]*b[d]*r[d],e[d+1]=f[d]*c[d]*r[d];this.x=a.slice(0,h);this.y=p.slice(0,h);this.m=e}a.prototype.interpolate=function(a){var b,l,c,r;for(l=b=this.x.length-2;(0>=b?0>=l:0<=l)&&!(this.x[l]<=a);0>=b?l+=1:--l);b=this.x[l+1]-this.x[l];
a=(a-this.x[l])/b;c=Math.pow(a,2);r=Math.pow(a,3);return(2*r-3*c+1)*this.y[l]+(r-2*c+a)*b*this.m[l]+(-2*r+3*c)*this.y[l+1]+(r-c)*b*this.m[l+1]};return a}();var g=function(){function a(a,p,l,c){var b,e,d,h,g,f,n,k,q,u,t;if(null!=a&&null!=p){d=null!=l&&null!=c;k=a.length-1;g=[];u=[];n=[];q=[];t=[];e=[];b=[];h=[];for(f=0;0<=k?f<k:f>k;0<=k?f+=1:--f)g[f]=a[f+1]-a[f];d&&(u[0]=3*(p[1]-p[0])/g[0]-3*l,u[k]=3*c-3*(p[k]-p[k-1])/g[k-1]);for(f=1;1<=k?f<k:f>k;1<=k?f+=1:--f)u[f]=3/g[f]*(p[f+1]-p[f])-3/g[f-1]*(p[f]-
p[f-1]);d?(n[0]=2*g[0],q[0]=.5,t[0]=u[0]/n[0]):(n[0]=1,q[0]=0,t[0]=0);for(f=1;1<=k?f<k:f>k;1<=k?f+=1:--f)n[f]=2*(a[f+1]-a[f-1])-g[f-1]*q[f-1],q[f]=g[f]/n[f],t[f]=(u[f]-g[f-1]*t[f-1])/n[f];d?(n[k]=g[k-1]*(2-q[k-1]),t[k]=(u[k]-g[k-1]*t[k-1])/n[k],e[k]=t[k]):(n[k]=1,t[k]=0,e[k]=0);for(f=l=k-1;0>=l?0>=f:0<=f;0>=l?f+=1:--f)e[f]=t[f]-q[f]*e[f+1],b[f]=(p[f+1]-p[f])/g[f]-g[f]*(e[f+1]+2*e[f])/3,h[f]=(e[f+1]-e[f])/(3*g[f]);this.x=a.slice(0,k+1);this.a=p.slice(0,k);this.b=b;this.c=e.slice(0,k);this.d=h}}a.prototype.derivative=
function(){var a,p,l,e,c;p=new this.constructor;p.x=this.x.slice(0,this.x.length);p.a=this.b.slice(0,this.b.length);c=this.c;l=0;for(e=c.length;l<e;l++)a=c[l],p.b=2*a;c=this.d;l=0;for(e=c.length;l<e;l++)a=c[l],p.c=3*a;a=0;for(l=this.d.length;0<=l?a<l:a>l;0<=l?a+=1:--a)p.d=0;return p};a.prototype.interpolate=function(a){var b,c;for(b=c=this.x.length-1;(0>=c?0>=b:0<=b)&&!(this.x[b]<=a);0>=c?b+=1:--b);a-=this.x[b];return this.a[b]+this.b[b]*a+this.c[b]*Math.pow(a,2)+this.d[b]*Math.pow(a,3)};return a}(),
e=function(){this._points=[];this._min={x:0,y:0};this._max={x:Infinity,y:Infinity}};e.prototype.setBoundary=function(a,b,c){this["_"+a][b]=c};e.prototype.add=function(a){var b=null;a.x>=this._min.x&&a.x<=this._max.x&&a.y>=this._min.y&&a.y<=this._max.y&&("xLocked"in a||(a.xLocked=!1),"yLocked"in a||(a.yLocked=!1),"safe"in a||(a.safe=!1),this._points.push(a),this._sortPoints(),b=this._points.indexOf(a));return b};e.prototype._sortPoints=function(){this._points.sort(function(a,b){return a.x-b.x})};e.prototype.remove=
function(a){var b=null;0<=a&&a<this._points.length&&!this._points[a].safe&&(b=this._points.splice(a,1));return b};e.prototype.getClosestFrom=function(a){if(!this._points.length)return null;for(var b=Infinity,c=null,e=0;e<this._points.length;e++){var h=Math.sqrt(Math.pow(a.x-this._points[e].x,2)+Math.pow(a.y-this._points[e].y,2));h<b&&(b=h,c=e)}return{index:c,distance:b}};e.prototype.getPoint=function(a){return 0<=a&&a<this._points.length?this._points[a]:null};e.prototype.getNumberOfPoints=function(){return this._points.length};
e.prototype.updatePoint=function(a,b){var c=a;0<=a&&a<this._points.length&&b.x>=this._min.x&&b.x<this._max.x&&b.y>=this._min.y&&b.y<this._max.y&&(this._points[a].xLocked||(this._points[a].x=b.x),this._points[a].yLocked||(this._points[a].y=b.y),a=this._points[a],this._sortPoints(),c=this._points.indexOf(a));return c};e.prototype.getXseries=function(){for(var a=[],b=0;b<this._points.length;b++)a.push(this._points[b].x);return a};e.prototype.getYseries=function(){for(var a=[],b=0;b<this._points.length;b++)a.push(this._points[b].y);
return a};var c=function(a,b,c,h){h=void 0===h?"natural":h;this._borderStyle={in:"1px solid #d3d3ff",out:"1px solid #e3e3e3"};this._controlPointRadius=8;this._controlPointColor={idle:"rgba(244, 66, 167, 0.5)",hovered:"rgba(0, 0, 255, 0.5)",grabbed:"rgba(0, 200, 0, 0.5)"};this._curveColor={idle:"rgba(0, 128, 255, 1)",moving:"rgba(255, 128, 0, 1)"};this._gridColor="rgba(0, 0, 0, 0.3)";this._textColor="rgba(0, 0, 0, 0.1)";this._curveThickness=1;this._backgroundColor=!1;this._mouse=null;this._pointGrabbedIndex=
this._pointHoveredIndex=-1;this._mouseDown=!1;this._ctx=this._canvas=null;this._screenRatio=window.devicePixelRatio;var p=null;if(p="string"===typeof a||a instanceof String?document.getElementById(a):a)this._canvas=document.createElement("canvas"),this._canvas.width=b,this._canvas.height=c,this._canvas.setAttribute("tabIndex",1),this._canvas.style.outline="none",this._canvas.style.cursor="default",this._canvas.style.border=this._borderStyle.out,this._canvas.onselectstart=function(){return!1},this._width=
b,this._height=c,p.appendChild(this._canvas),this._ctx=this._canvas.getContext("2d"),this._ctx.scale(this._screenRatio,this._screenRatio),this._canvas.addEventListener("mousemove",this._onCanvasMouseMove.bind(this),!1),this._canvas.addEventListener("mousedown",this._onCanvasMouseDown.bind(this),!1),window.addEventListener("mouseup",this._onCanvasMouseUp.bind(this),!1),this._canvas.addEventListener("dblclick",this._onCanvasMouseDbclick.bind(this),!1),this._canvas.addEventListener("mouseleave",this._onCanvasMouseLeave.bind(this),
!1),this._canvas.addEventListener("mouseenter",this._onCanvasMouseEnter.bind(this),!1),this._canvas.addEventListener("keyup",this._onKeyUp.bind(this),!1),this._splineConstructor=g,"monotonic"===h&&(this._splineConstructor=q),this._pointCollection=new e,this._pointCollection.setBoundary("max","x",b),this._pointCollection.setBoundary("max","y",c),this._xSeriesInterpolated=(new Float32Array(this._width)).fill(0),this._ySeriesInterpolated=(new Float32Array(this._width)).fill(0),this._gridStep=1/3,this._onEvents=
{movePoint:null,releasePoint:null,pointAdded:null},this.draw()};c.prototype.getXSeriesInterpolated=function(){return this._xSeriesInterpolated};c.prototype.getYSeriesInterpolated=function(){return this._ySeriesInterpolated};c.prototype.setControlPointRadius=function(a){this._controlPointRadius=a};c.prototype.setControlPointColor=function(a,b){this._controlPointColor[a]=b};c.prototype.setCurveColor=function(a,b){this._curveColor[a]=b};c.prototype.setGridColor=function(a){this._gridColor=a};c.prototype.setGridStep=
function(a){this._gridStep=0>=a||1<=a?0:a;this.draw()};c.prototype.setTextColor=function(a){this._textColor=a};c.prototype.setCurveThickness=function(a){this._curveThickness=a};c.prototype.setBackgroundColor=function(a){this._backgroundColor=a};c.prototype.setSplineType=function(a){this._splineConstructor="monotonic"===a?q:g};c.prototype._updateMousePosition=function(a){var b=this._canvas.getBoundingClientRect();this._mouse={x:a.clientX-b.left,y:this._height-(a.clientY-b.top)}};c.prototype._onCanvasMouseMove=
function(a){this._updateMousePosition(a);if(a=this._pointCollection.getClosestFrom(this._mouse))-1==this._pointGrabbedIndex?a.distance<=this._controlPointRadius?this._pointHoveredIndex=a.index:(a=!1,-1!=this._pointHoveredIndex&&(a=!0),this._pointHoveredIndex=-1,a&&this.draw()):this._pointHoveredIndex=this._pointGrabbedIndex=this._pointCollection.updatePoint(this._pointGrabbedIndex,this._mouse),-1==this._pointHoveredIndex&&-1==this._pointGrabbedIndex||this.draw(),-1!=this._pointGrabbedIndex&&(a=this._pointCollection.getPoint(this._pointGrabbedIndex),
this._drawCoordinates(Math.round(a.x/this._width*1E3)/1E3,Math.round(a.y/this._height*1E3)/1E3),this._onEvents.movePoint&&this._onEvents.movePoint(this))};c.prototype._onCanvasMouseDown=function(a){this._mouseDown=!0;-1!=this._pointHoveredIndex&&(this._pointGrabbedIndex=this._pointHoveredIndex)};c.prototype._onCanvasMouseUp=function(a){a=-1!=this._pointGrabbedIndex;this._mouseDown=!1;this._pointGrabbedIndex=-1;this.draw();this._onEvents.releasePoint&&a&&this._onEvents.releasePoint(this)};c.prototype._onCanvasMouseDbclick=
function(a){this._canvas.focus();-1==this._pointHoveredIndex?this._pointHoveredIndex=this.add({x:this._mouse.x/this._width,y:this._mouse.y/this._height}):(this.remove(this._pointHoveredIndex),this._pointGrabbedIndex=this._pointHoveredIndex=-1)};c.prototype._onCanvasMouseLeave=function(a){this.draw()};c.prototype._onCanvasMouseEnter=function(a){this._canvas.focus();this._canvas.style.border=this._borderStyle.in};c.prototype._onKeyUp=function(a){if(this._mouse)switch(a.key){case "d":this.remove(this._pointHoveredIndex)}};
c.prototype.add=function(a,b){b=void 0===b?!0:b;var c=null;"x"in a&&"y"in a&&(a.x*=this._width,a.y*=this._height,c=this._pointCollection.add(a));b&&this.draw();this._onEvents.pointAdded&&this._onEvents.pointAdded(this);return c};c.prototype.remove=function(a){this._pointCollection.remove(a);this.draw();this._onEvents.pointRemoved&&this._onEvents.pointRemoved(this)};c.prototype.draw=function(){this._ctx.clearRect(0,0,this._width,this._height);this._fillBackground();this._drawGrid();this._drawData()};
c.prototype._fillBackground=function(){this._backgroundColor&&(this._ctx.beginPath(),this._ctx.rect(0,0,this._width,this._height),this._ctx.fillStyle=this._backgroundColor,this._ctx.fill())};c.prototype._drawCoordinates=function(a,b){var c=14/this._screenRatio;this._ctx.fillStyle=this._textColor;this._ctx.font=c+"px courier";this._ctx.fillText("x: "+a,10/this._screenRatio,20/this._screenRatio);this._ctx.fillText("y: "+b,10/this._screenRatio,35/this._screenRatio)};c.prototype._drawGrid=function(){var a=
this._gridStep;if(0!=a){this._ctx.beginPath();this._ctx.moveTo(0,0);for(var b=a*this._height/this._screenRatio;b<this._height/this._screenRatio;b+=a*this._height/this._screenRatio)this._ctx.moveTo(0,Math.round(b)+.5/this._screenRatio),this._ctx.lineTo(this._width,Math.round(b)+.5/this._screenRatio);this._ctx.moveTo(0,0);for(b=a*this._width/this._screenRatio;b<this._width/this._screenRatio;b+=a*this._width/this._screenRatio)this._ctx.moveTo(Math.round(b)+.5/this._screenRatio,0),this._ctx.lineTo(Math.round(b)+
.5/this._screenRatio,this._height);this._ctx.strokeStyle=this._gridColor;this._ctx.lineWidth=.5;this._ctx.stroke();this._ctx.closePath()}};c.prototype._drawData=function(a,b){a=void 0===a?!0:a;b=void 0===b?!0:b;var c=this._pointCollection.getXseries(),e=this._pointCollection.getYseries(),h=this._width,g=this._height;if(c.length){if(a){this._ctx.beginPath();this._ctx.moveTo(c[0]/this._screenRatio,(g-e[0])/this._screenRatio);a=new this._splineConstructor(c,e);this._xSeriesInterpolated.fill(0);this._ySeriesInterpolated.fill(0);
for(var m=0;m<Math.ceil(c[0]);m++){var d=e[0];this._xSeriesInterpolated[m]=m/h;this._ySeriesInterpolated[m]=d/g;d=0>d?.5:d>g?g-.5:d;this._ctx.lineTo(m/this._screenRatio,(g-d)/this._screenRatio)}for(m=Math.ceil(c[0]);m<Math.ceil(c[c.length-1]);m++)d=a.interpolate(m),this._xSeriesInterpolated[m]=m/h,this._ySeriesInterpolated[m]=d/g,d=0>d?.5:d>g?g-.5:d,this._ctx.lineTo(m/this._screenRatio,(g-d)/this._screenRatio);for(m=Math.ceil(c[c.length-1]);m<h;m++)d=e[e.length-1],this._xSeriesInterpolated[m]=m/h,
this._ySeriesInterpolated[m]=d/g,d=0>d?.5:d>g?g-.5:d,this._ctx.lineTo(m/this._screenRatio,(g-d)/this._screenRatio);this._ctx.strokeStyle=-1==this._pointGrabbedIndex?this._curveColor.idle:this._curveColor.moving;this._ctx.lineWidth=this._curveThickness/this._screenRatio;this._ctx.stroke();this._ctx.closePath()}if(b)for(b=0;b<c.length;b++)this._ctx.beginPath(),this._ctx.arc(c[b]/this._screenRatio,(g-e[b])/this._screenRatio,this._controlPointRadius/this._screenRatio,0,2*Math.PI),this._ctx.fillStyle=
-1==this._pointHoveredIndex?this._controlPointColor.idle:b==this._pointHoveredIndex?this._mouseDown?this._controlPointColor.grabbed:this._controlPointColor.hovered:this._controlPointColor.idle,this._ctx.fill(),this._ctx.closePath()}};c.prototype.getValue=function(a){var b=this._pointCollection.getXseries(),c=this._pointCollection.getYseries();return a<=b[0]/this._width?c[0]/this._height:a>=b[b.length-1]/this._width?c[c.length-1]/this._height:(new this._splineConstructor(b,c)).interpolate(a*this._width)/
this._height};c.prototype.on=function(a,b){this._onEvents[a]=b};h.CanvasSpliner=c;Object.defineProperty(h,"__esModule",{value:!0})});
